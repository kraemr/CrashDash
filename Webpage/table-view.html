<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="style.css">
    <style>
      .control_row{
        display: flex;
        gap: 32px;
      }
  </style>
  </head>
  <script>
    var currentPage = 1;
    var filterValue  =  null; // something like '2016' 
    var filterCond   =  null; // something like '<'
    var filterColumn =  null; // something like 'land'

    function applyFilter(){
      filterColumn = readSelectedColumn();
      filterCond = readSelectedOperator();
      let filterVal = document.querySelector('#Filter_Value_Input');
      filterValue = filterVal.value;
      loadpage();
    }

    function addRow(element) {
      let tableBody = document.querySelector('#table-data tbody');
      let newRow = tableBody.insertRow();
      
      let cell = newRow.insertCell(0);
      cell.innerHTML = element["land_str"];
      let cell1 = newRow.insertCell(1);
      cell1.innerHTML = element["hour"];
      let cell2 = newRow.insertCell(2);
      cell2.innerHTML = element["day_str"];
      let cell3 = newRow.insertCell(3);
      cell3.innerHTML = element["month"];
      let cell4 = newRow.insertCell(4);
      cell4.innerHTML = element["year"];
      let cell5 = newRow.insertCell(5);
      cell5.innerHTML = element["category_str"];
      let cell6 = newRow.insertCell(6);
      cell6.innerHTML = element["kind_str"];
      let cell7 = newRow.insertCell(7);
      cell7.innerHTML = element["type_str"];
      let cell8 = newRow.insertCell(8);
      cell8.innerHTML = element["light_condition_str"];
      let cell9 = newRow.insertCell(9)
      let link = document.createElement("a");
      link.href = "deails.html?id=" + element["Id"];
      link.text = "More Details";
      cell9.appendChild(link);
      /*
    category TINYINT, # UKATEGORIE
    kind TINYINT, # UART
    type TINYINT, # UTYP1
    light_condition TINYINT, # ULICHTVERH
    bycicle_involved BOOLEAN,
    car_involved BOOLEAN,
    passenger_involved BOOLEAN,
    motorcycle_involved BOOLEAN,
    delivery_van_involved BOOLEAN,
    truck_bus_or_tram_involved BOOLEAN,
    road_surface_condition TINYINT,
    */
      
    }

  function removeAllRows() { // resets the table
      let tableBody = document.querySelector('#table-data tbody');
      tableBody.innerHTML = '';
  }

  function updatePagination() { // update page numbers
    const paginationContainer = document.getElementById('pagination');
    paginationContainer.innerHTML = '';
    const page = document.createElement('span');
    page.textContent = "Page: ";
    for (let i = currentPage; i <= currentPage + 3; i++) {
        const pageNumber = document.createElement('span');
        pageNumber.textContent = i + ' ';
        if (i === currentPage) {
          pageNumber.style.fontWeight = 'bold';
        }
        paginationContainer.appendChild(pageNumber);
        }
        const ellipsis = document.createElement('span');
        ellipsis.textContent = '... ';
        paginationContainer.appendChild(ellipsis);
    }

  function loadpage(){ //loads currentPage
    updatePagination();
    removeAllRows();
    var xhr = new XMLHttpRequest();
    if(filterValue === null || filterCond === null || filterColumn === null){
      xhr.open('GET', "../php/get-pages.php?page="+currentPage, true);
    }
    else{
      xhr.open(
        'GET', "../php/get-pages.php?page="+currentPage+"&col="+filterColumn+"&cond="+filterCond+"&val="+filterValue, 
        true
      );
    }
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4 && xhr.status === 200) {
        var data = JSON.parse(xhr.responseText);
        data.forEach(element => {
          addRow(element);
        }); //foreach 
      } // if xhr ready
    };// xhr call back
    xhr.send();
    return xhr.responseType;
  }

  function readSelectedColumn() {
    var selectElement = document.getElementById("Filter_Column");
    return selectElement.value;
  }

  // Reads the given filteroperator and parses it
  function readSelectedOperator(){
    var selectElement = document.getElementById("Filter_Condition");
    const cond_map={"greater":"greater",
                    "lesser":"less",
                    "equal":"eq",
                    "greater or equal":"greatereq",
                    "lesser or equal":"lesseq",
                    "none":null
                    };
    return cond_map[selectElement.value]; 
  }

  function changepage(action){ // loads next or previous page
    // three = becuase of js string shenanigans example: 1 == "1" is true 1 == 1 also, but 1 === "1" is false
    if(action === "next"){ 
      currentPage++;
    }
    else if(action === "back"){
      currentPage--;
    }
    loadpage();
  }
  window.onload = loadpage;

  </script>

  <body>
  <div class="navbar">
    <div class="logo">
      <a href="home.html">
          <img src="img/logo.jpg" alt="logo">
      </a>
  </div>
    <ul class="nav-menu">
      <li><a href="home.html">Home</a></li>
      <li><a href="dashboard.html">Dashboard</a></li>
      <li><a href="map.html">Map</a></li>
      <li><a href="table-view.html">Table-View</a></li>
    </ul>
  </div>

  <div class="content">
    <div class="control_row">
      <div class="leftSided-HBox" style="gap:64px;">
        <div>
          <label for="Filter_Column">Filter Column:</label>
          <select id="Filter_Column" name="selectOption">
              <option value="land">Bundesland</option>
              <option value="hour">Stunde</option>
              <option value="day">Wochentag</option>
              <option value="month">Monat</option>
              <option value="year">Jahr</option>
              <option value="category">Kategorie</option>
              <option value="kind">Unfall-Art</option>
              <option value="type">Unfall-Typ</option>
              <option value="light_condition">Lichtverhältnis</option>
              <!-- Add more options as needed -->
          </select>
        </div>
  
        <div>
          <label for="Filter_Condition">Filter Condition:</label>
          <select id="Filter_Condition" name="selectOption">
              <option value="greater">greater</option>
              <option value="leser">lesser</option>
              <option value="equal">equal</option>
              <option value="greater or equal">greater or equal</option>
              <option value="lesser or equal">less or equal</option>
              <option value="none">None</option>
          </select>
        </div>
    
        <div style="width: 500px;">
          <label for="Filter_Value_Input">Enter Value:</label>
          <input type="text" id="Filter_Value_Input" name="Filter_Value_Input" placeholder="">
        </div>
      </div>
      
      <button onclick="applyFilter()">Apply Filter</button>
    </div>
    
    <table id="table-data" border="1">
      <thead>
          <tr>
              <th>Bundesland</th>
              <th>Stunde</th>
              <th>Wochentag</th>
              <th>Monat</th>
              <th>Jahr</th>
              <th>Kategorie</th>
              <th>Unfall-Art</th>
              <th>Unfall-Typ</th>
              <th>Lichtverhältnis</th>
              <th>Details</th>



          </tr>
      </thead>
      <tbody>
          <!-- This will be dynamically filled by js -->
      </tbody>
  </table>
  <div class="control_row">
    <button onclick="changepage('back')">Back</button>
    <div class="page-numbers" id="pagination"></div>
    <button onclick="changepage('next')">Next</button>
  </div>
  </div>
</div>
</body>
</html>
