<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js"></script>
</head>
<body>
  <div class="navbar">
    <div class="logo">
      <a href="home.html">
          <img src="img/logo.jpg" alt="logo">
      </a>
  </div>
    <ul class="nav-menu">
      <li><a href="home.html">Home</a></li>
      <li><a href="dashboad.html">Dashboard</a></li>
      <li><a href="map.html">Map</a></li>
      <li><a href="table-view.html">Table-View</a></li>
    </ul>
  </div>

  <div class="content">
      <div style="display: flex; justify-content: space-between; gap: 64px;">

        <div class="map-menu">
          <p>Nach Bundesland/Stadt filtern:</p>
          <div class="centered-HBox">
            <input type="text" id="search-filter" placeholder="Bundesland/Stadt">
            <button onclick="search()">Filtern</button>
          </div>
          <p>Jahr:</p>
          <select id="year">
            <option value="all">2016-2022</option>
            <option value="2022" selected>2022</option>
            <option value="2021">2021</option>
            <option value="2020">2020</option>
            <option value="2019">2019</option>
            <option value="2018">2018</option>
            <option value="2017">2017</option>
            <option value="2016">2016</option>
          </select> 
        </div>
        <div class="mapDiv">
          <div id="map" style="height: 85vh; border-radius: 16px;"></div>
        </div>
      </div>
  </div>  
</body>

<script>
  var mymap = L.map('map').setView([51.505, -0.09], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
  }).addTo(mymap);

  // Gruppe fÃ¼r die Marker erstellen
  var markers = L.layerGroup().addTo(mymap);

  var geojsonLayer;

  function search() {
    // Alte GeoJSON entfernen
    if (geojsonLayer != null) {
      
    }
    

    var query = document.getElementById("search-filter").value;
    var url = "https://nominatim.openstreetmap.org/search?q=" + query + "&format=json&addressdetails=1&limit=1&limit=1&countrycodes=de";
    fetch(url)
      .then(response => response.json())
      .then(data => {
        var lat = data[0].lat;
        var lon = data[0].lon;
        mymap.setView([lat, lon], 10);
        var cityUrl = "https://nominatim.openstreetmap.org/search.php?q=" + query + "&polygon_geojson=1&format=geojson&limit=1&countrycodes=de";
        fetch(cityUrl)
          .then(response => response.json())
          .then(data => {
          geojsonLayer = L.geoJSON(data);
          var bounds = geojsonLayer.getBounds();  
          mymap.fitBounds(bounds);
          // Alle Marker die nicht in der Grenze liegen entfernen
          markers.eachLayer(function (marker) {
            if (!bounds.contains(marker.getLatLng())) {
              markers.removeLayer(marker);
            }
          });
          L.geoJSON(data, {
            style: function(feature) {
              return {
                fillColor: '#3296FF',
                fillOpacity: 0.4,
                color: '#3296FF',
                weight: 2
              };
          }}).addTo(mymap);
        }).catch(error => console.error(error));		
    }).catch(error => console.error(error));
  }
</script>
</html>
